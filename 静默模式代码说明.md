# é™é»˜æ¨¡å¼ä»£ç å®ç°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é™é»˜æ¨¡å¼ï¼ˆSilent Modeï¼‰æ˜¯æŒ‡å½“å…¶ä»–äººè¿œç¨‹è¿æ¥æ­¤ç”µè„‘æ—¶ï¼Œ**ä¸å¼¹å‡ºè¿æ¥ç®¡ç†çª—å£**ï¼Œé¿å…å¹²æ‰°æ­£åœ¨ä½¿ç”¨ç”µè„‘çš„ç”¨æˆ·ã€‚

---

## ğŸ” å½“å‰å®ç°

### ä»£ç ä½ç½®

`src/server/connection.rs` ç¬¬ 4374-4378 è¡Œ

### ä»£ç å†…å®¹

```rust
// åœ¨Windowså¹³å°ä¸Šä½¿ç”¨æ— UIæ¨¡å¼ï¼Œé¿å…å¼¹å‡ºçª—å£!!
#[cfg(target_os = "windows")]
{
    args = vec!["--cm-no-ui"];
}
```

### ä¸Šä¸‹æ–‡ä»£ç 

```rust
// src/server/connection.rs çº¦ç¬¬ 4340-4420 è¡Œ
async fn create_ipc_for_cm(...) -> ResultType<...> {
    let mut stream = None;
    
    // å°è¯•è¿æ¥åˆ°ç°æœ‰çš„è¿æ¥ç®¡ç†å™¨
    if let Ok(s) = crate::ipc::connect(1000, "_cm").await {
        stream = Some(s);
    } else {
        // è¿æ¥å¤±è´¥ï¼Œéœ€è¦å¯åŠ¨æ–°çš„è¿æ¥ç®¡ç†å™¨
        
        let mut args = vec!["--cm"];  // é»˜è®¤ä½¿ç”¨ UI æ¨¡å¼
        
        // Linux å¹³å°ï¼šheadless ç¯å¢ƒä½¿ç”¨æ—  UI æ¨¡å¼
        #[cfg(target_os = "linux")]
        if crate::platform::is_headless_allowed() && linux_desktop_manager::is_headless() {
            // ... è·å–ç”¨æˆ·ä¿¡æ¯ ...
            args = vec!["--cm-no-ui"];
        }
        
        // Windows å¹³å°ï¼šå¼ºåˆ¶ä½¿ç”¨æ—  UI æ¨¡å¼ï¼ˆé™é»˜æ¨¡å¼ï¼‰
        #[cfg(target_os = "windows")]
        {
            args = vec!["--cm-no-ui"];
        }
        
        // å¯åŠ¨è¿æ¥ç®¡ç†å™¨è¿›ç¨‹
        if crate::platform::is_root() {
            // ä»¥ç”¨æˆ·æƒé™è¿è¡Œ
            res = crate::platform::run_as_user(args.clone());
        } else {
            // ç›´æ¥è¿è¡Œ
            super::CHILD_PROCESS.lock().unwrap().push(crate::run_me(args)?);
        }
    }
}
```

---

## âœ… å®ç°æ­£ç¡®æ€§åˆ†æ

### ä¼˜ç‚¹

1. **å¹³å°ç‰¹å®š**ï¼šä½¿ç”¨ `#[cfg(target_os = "windows")]` æ¡ä»¶ç¼–è¯‘ï¼Œåªåœ¨ Windows ä¸Šç”Ÿæ•ˆ
2. **ç®€æ´æ˜äº†**ï¼šç›´æ¥è¦†ç›– `args`ï¼Œå¼ºåˆ¶ä½¿ç”¨ `--cm-no-ui`
3. **ä½ç½®åˆé€‚**ï¼šåœ¨å¯åŠ¨è¿æ¥ç®¡ç†å™¨ä¹‹å‰è®¾ç½®å‚æ•°

### æ½œåœ¨é—®é¢˜

#### é—®é¢˜ 1ï¼šLinux é…ç½®å¯èƒ½è¢«è¦†ç›–

å¦‚æœ Linux å—åœ¨ Windows å—ä¹‹å‰ï¼ŒLinux çš„é…ç½®ä¼šè¢«è¦†ç›–ã€‚ä½†ä»ä»£ç çœ‹ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºï¼š
- Linux å—æœ‰æ¡ä»¶ï¼š`if is_headless()`
- Windows å—æ— æ¡ä»¶è¦†ç›–
- ä¸¤è€…ä¸ä¼šåŒæ—¶ç¼–è¯‘ï¼ˆæ¡ä»¶ç¼–è¯‘ï¼‰

#### é—®é¢˜ 2ï¼šæ²¡æœ‰é…ç½®é€‰é¡¹

å½“å‰å®ç°æ˜¯**ç¡¬ç¼–ç **ï¼Œç”¨æˆ·æ— æ³•é€šè¿‡é…ç½®æ–‡ä»¶å…³é—­é™é»˜æ¨¡å¼ã€‚

**å¯èƒ½çš„æ”¹è¿›**ï¼š

```rust
// æ–¹æ¡ˆ 1ï¼šæ·»åŠ é…ç½®é€‰é¡¹
#[cfg(target_os = "windows")]
{
    // æ£€æŸ¥é…ç½®ï¼Œé»˜è®¤å¯ç”¨é™é»˜æ¨¡å¼
    let silent_mode = Config::get_option("silent_mode");
    if silent_mode != "N" {  // ä¸æ˜¯ "N" å°±å¯ç”¨
        args = vec!["--cm-no-ui"];
    }
}

// æ–¹æ¡ˆ 2ï¼šç¯å¢ƒå˜é‡æ§åˆ¶
#[cfg(target_os = "windows")]
{
    if std::env::var("RUSTDESK_SHOW_CM_UI").is_err() {
        // ç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œä½¿ç”¨é™é»˜æ¨¡å¼
        args = vec!["--cm-no-ui"];
    }
}
```

---

## ğŸ”¬ å·¥ä½œåŸç†

### è¿æ¥ç®¡ç†å™¨ï¼ˆConnection Managerï¼‰

```
è¿œç¨‹è¿æ¥è¯·æ±‚ â†’ å¯åŠ¨ CM â†’ CM å¤„ç†è¿æ¥ â†’ å»ºç«‹ä¼šè¯
                 â†“
         ä¸¤ç§æ¨¡å¼ï¼š
         1. --cm      â†’ æ˜¾ç¤º UI çª—å£
         2. --cm-no-ui â†’ ä¸æ˜¾ç¤º UIï¼ˆé™é»˜ï¼‰
```

### --cm vs --cm-no-ui

#### --cmï¼ˆæ­£å¸¸æ¨¡å¼ï¼‰

```rust
// src/core_main.rs ç¬¬ 585-588 è¡Œ
} else if args[0] == "--cm" {
    // å¯åŠ¨è¿æ¥ç®¡ç†å™¨çª—å£
    crate::ui_interface::start_option_status_sync();
    // Flutter ä¼šåˆ›å»ºè¿æ¥ç®¡ç†çª—å£
}
```

**æ•ˆæœ**ï¼š
- å¼¹å‡ºè¿æ¥ç®¡ç†çª—å£
- æ˜¾ç¤ºè¿æ¥çŠ¶æ€ã€è¿œç¨‹ IPã€æ“ä½œæ—¥å¿—
- ç”¨æˆ·å¯ä»¥çœ‹åˆ°å’Œæ§åˆ¶è¿æ¥

#### --cm-no-uiï¼ˆé™é»˜æ¨¡å¼ï¼‰

```rust
// src/core_main.rs ç¬¬ 589-596 è¡Œ
} else if args[0] == "--cm-no-ui" {
    #[cfg(feature = "flutter")]
    #[cfg(not(any(target_os = "android", target_os = "ios")))]
    {
        crate::ui_interface::start_option_status_sync();
        crate::flutter::connection_manager::start_cm_no_ui();
    }
    return None;
}
```

**æ•ˆæœ**ï¼š
- ä¸åˆ›å»ºçª—å£
- åå°å¤„ç†è¿æ¥
- æ—¥å¿—è®°å½•æ‰€æœ‰æ“ä½œ

---

## ğŸ¯ æ¨èå®ç°

### å½“å‰å®ç°ï¼ˆæ¨èç”¨äºä¼ä¸šéƒ¨ç½²ï¼‰

```rust
// src/server/connection.rs
#[cfg(target_os = "windows")]
{
    args = vec!["--cm-no-ui"];
}
```

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… ä¼ä¸šç»Ÿä¸€éƒ¨ç½²
- âœ… æ— äººå€¼å®ˆæœåŠ¡å™¨
- âœ… æ‰¹é‡è¿œç¨‹ç®¡ç†
- âœ… ä¸å¸Œæœ›ç”¨æˆ·çœ‹åˆ°è¿æ¥çª—å£

### å¯é…ç½®å®ç°ï¼ˆæ¨èç”¨äºçµæ´»éœ€æ±‚ï¼‰

```rust
// src/server/connection.rs
#[cfg(target_os = "windows")]
{
    // ä»é…ç½®æ–‡ä»¶è¯»å–é™é»˜æ¨¡å¼è®¾ç½®
    // é»˜è®¤å€¼ï¼štrueï¼ˆå¯ç”¨é™é»˜æ¨¡å¼ï¼‰
    let silent_mode = Config::get_option("silent_mode");
    
    // silent_mode ä¸º "N" æ—¶æ‰æ˜¾ç¤º UI
    if silent_mode != "N" {
        args = vec!["--cm-no-ui"];
    } else {
        log::info!("Silent mode disabled by config");
    }
}
```

**é…ç½®æ–¹å¼**ï¼š

```toml
# RustDesk2.toml
[options]
silent_mode = "Y"  # å¯ç”¨é™é»˜æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
# silent_mode = "N"  # ç¦ç”¨é™é»˜æ¨¡å¼ï¼Œæ˜¾ç¤ºè¿æ¥çª—å£
```

**ä¼˜åŠ¿**ï¼š
- ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©
- ä¸éœ€è¦é‡æ–°ç¼–è¯‘
- æ›´çµæ´»

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯• 1ï¼šéªŒè¯é™é»˜æ¨¡å¼ç”Ÿæ•ˆ

```powershell
# 1. å¯åŠ¨è¢«æ§ç«¯
.\rustdesk.exe

# 2. ä»æ§åˆ¶ç«¯è¿æ¥

# 3. æ£€æŸ¥è¢«æ§ç«¯è¿›ç¨‹
Get-Process rustdesk | Select-Object Name, CommandLine

# é¢„æœŸè¾“å‡ºï¼š
# Name        CommandLine
# ----        -----------
# rustdesk    rustdesk.exe
# rustdesk    rustdesk.exe --cm-no-ui  â† è¿™ä¸ªè¿›ç¨‹è¯´æ˜é™é»˜æ¨¡å¼å·²ç”Ÿæ•ˆ
```

### æµ‹è¯• 2ï¼šéªŒè¯ä¸å¼¹çª—

```powershell
# 1. å¯åŠ¨ç¨‹åº
.\rustdesk.exe

# 2. è®°å½•å½“å‰çª—å£æ•°é‡
$before = (Get-Process rustdesk | Where-Object {$_.MainWindowTitle -ne ""}).Count

# 3. ä»è¿œç¨‹è¿æ¥

# 4. å†æ¬¡æ£€æŸ¥çª—å£æ•°é‡
$after = (Get-Process rustdesk | Where-Object {$_.MainWindowTitle -ne ""}).Count

# 5. éªŒè¯
if ($after -eq $before) {
    Write-Host "âœ… é™é»˜æ¨¡å¼ç”Ÿæ•ˆï¼šçª—å£æ•°é‡æœªå¢åŠ "
} else {
    Write-Host "âŒ é™é»˜æ¨¡å¼å¤±è´¥ï¼šæœ‰æ–°çª—å£å¼¹å‡º"
}
```

### æµ‹è¯• 3ï¼šéªŒè¯åŠŸèƒ½å®Œæ•´æ€§

```powershell
# é™é»˜æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰åŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼š

# 1. è¿œç¨‹æ§åˆ¶ âœ…
# 2. æ–‡ä»¶ä¼ è¾“ âœ…
# 3. å‰ªè´´æ¿åŒæ­¥ âœ…
# 4. éŸ³é¢‘ä¼ è¾“ âœ…
# 5. æ—¥å¿—è®°å½• âœ…

# æ£€æŸ¥æ—¥å¿—
Get-Content "$env:APPDATA\RustDesk\rustdesk.log" -Tail 20

# åº”è¯¥çœ‹åˆ°è¿æ¥è®°å½•ï¼š
# [INFO] Connection established from 192.168.1.100
# [INFO] CM started in no-ui mode
# [INFO] Session started
```

---

## ğŸ“Š å¯¹æ¯”åˆ†æ

### æ­£å¸¸æ¨¡å¼ vs é™é»˜æ¨¡å¼

| ç‰¹æ€§ | æ­£å¸¸æ¨¡å¼ (--cm) | é™é»˜æ¨¡å¼ (--cm-no-ui) |
|------|----------------|---------------------|
| **UI çª—å£** | âœ… å¼¹å‡ºè¿æ¥ç®¡ç†çª—å£ | âŒ ä¸å¼¹å‡ºçª—å£ |
| **ç”¨æˆ·æ„ŸçŸ¥** | æ˜æ˜¾ï¼ˆæœ‰çª—å£ï¼‰ | æ— æ„ŸçŸ¥ï¼ˆåå°è¿è¡Œï¼‰ |
| **ä»»åŠ¡æ å›¾æ ‡** | æœ‰ç‹¬ç«‹å›¾æ ‡ | æ— ç‹¬ç«‹å›¾æ ‡ |
| **è¿æ¥è®°å½•** | UI æ˜¾ç¤º + æ—¥å¿— | ä»…æ—¥å¿— |
| **ç”¨æˆ·æ§åˆ¶** | å¯ç‚¹å‡»å…³é—­è¿æ¥ | æ— æ³•ä» UI æ§åˆ¶ |
| **èµ„æºå ç”¨** | ç¨é«˜ï¼ˆæœ‰ UIï¼‰ | ç¨ä½ï¼ˆæ—  UIï¼‰ |
| **é€‚ç”¨åœºæ™¯** | ä¸ªäººç”µè„‘ | æœåŠ¡å™¨ã€æ— äººå€¼å®ˆ |

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### åœºæ™¯ 1ï¼šä¼ä¸šæ‰¹é‡éƒ¨ç½²

**æ¨è**ï¼šä½¿ç”¨å½“å‰å®ç°ï¼ˆç¡¬ç¼–ç é™é»˜æ¨¡å¼ï¼‰

**åŸå› **ï¼š
- ç»Ÿä¸€ä½“éªŒ
- é¿å…ç”¨æˆ·è¯¯æ“ä½œ
- å‡å°‘æ”¯æŒæˆæœ¬

**å®æ–½**ï¼š
```rust
#[cfg(target_os = "windows")]
{
    args = vec!["--cm-no-ui"];  // å¼ºåˆ¶é™é»˜
}
```

### åœºæ™¯ 2ï¼šæ··åˆç¯å¢ƒ

**æ¨è**ï¼šä½¿ç”¨å¯é…ç½®å®ç°

**åŸå› **ï¼š
- ä¸åŒç”¨æˆ·ä¸åŒéœ€æ±‚
- IT äººå‘˜éœ€è¦çœ‹åˆ°è¿æ¥çª—å£
- æ™®é€šç”¨æˆ·éœ€è¦é™é»˜æ¨¡å¼

**å®æ–½**ï¼š
```rust
#[cfg(target_os = "windows")]
{
    let silent_mode = Config::get_option("silent_mode");
    if silent_mode != "N" {
        args = vec!["--cm-no-ui"];
    }
}
```

### åœºæ™¯ 3ï¼šä¸ªäººä½¿ç”¨

**æ¨è**ï¼šä½¿ç”¨æ­£å¸¸æ¨¡å¼ï¼ˆä¸ä¿®æ”¹ä»£ç ï¼‰

**åŸå› **ï¼š
- çŸ¥é“è°åœ¨è¿æ¥
- å¯ä»¥éšæ—¶æ–­å¼€è¿æ¥
- æ›´å®‰å…¨

**å®æ–½**ï¼š
```rust
// åˆ é™¤æˆ–æ³¨é‡Šæ‰é™é»˜æ¨¡å¼ä»£ç 
#[cfg(target_os = "windows")]
{
    // args = vec!["--cm-no-ui"];  // æ³¨é‡Šæ‰
}
```

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### é™é»˜æ¨¡å¼çš„å®‰å…¨å½±å“

#### ä¼˜ç‚¹

1. **ç”¨æˆ·æ— æ„ŸçŸ¥**ï¼šä¸ä¼šå› ä¸ºå¼¹çª—å¼•èµ·æ³¨æ„
2. **ä¸“ä¸šæ€§**ï¼šIT ç®¡ç†å‘˜è¿œç¨‹ç»´æŠ¤æ—¶ä¸æ‰“æ‰°ç”¨æˆ·

#### é£é™©

1. **éšè”½è¿æ¥**ï¼šç”¨æˆ·ä¸çŸ¥é“æœ‰äººåœ¨è¿œç¨‹æ§åˆ¶
2. **ç¼ºä¹ç›‘ç£**ï¼šæ— æ³•ä» UI çœ‹åˆ°è¿æ¥çŠ¶æ€
3. **æ»¥ç”¨é£é™©**ï¼šå¯èƒ½è¢«ç”¨äºæœªæˆæƒè®¿é—®

### å®‰å…¨å»ºè®®

1. **æ—¥å¿—å®¡è®¡**ï¼š
   ```rust
   // æ‰€æœ‰è¿æ¥éƒ½åº”è¯¥è®°å½•è¯¦ç»†æ—¥å¿—
   log::info!("Connection from {} at {}", remote_ip, timestamp);
   log::info!("Session duration: {} minutes", duration);
   ```

2. **é€šçŸ¥æœºåˆ¶**ï¼š
   ```rust
   // å³ä½¿ä¸æ˜¾ç¤ºçª—å£ï¼Œä¹Ÿå¯ä»¥å‘é€é€šçŸ¥
   #[cfg(target_os = "windows")]
   {
       // å‘é€ç³»ç»Ÿé€šçŸ¥
       show_notification("è¿œç¨‹è¿æ¥", "æœ‰äººæ­£åœ¨è¿æ¥æ­¤ç”µè„‘");
   }
   ```

3. **è®¿é—®æ§åˆ¶**ï¼š
   ```rust
   // é™åˆ¶å¯ä»¥è¿æ¥çš„ IP åœ°å€
   let allowed_ips = vec!["192.168.1.100", "10.0.0.50"];
   if !allowed_ips.contains(&remote_ip.as_str()) {
       bail!("Unauthorized IP address");
   }
   ```

---

## ğŸ“ æ€»ç»“

### å½“å‰å®ç°è¯„ä»·

| è¯„ä¼°é¡¹ | è¯„åˆ† | è¯´æ˜ |
|--------|------|------|
| **åŠŸèƒ½æ€§** | â­â­â­â­â­ | å®Œç¾å®ç°é™é»˜æ¨¡å¼ |
| **ä»£ç è´¨é‡** | â­â­â­â­ | ç®€æ´æ¸…æ™°ï¼Œä½†ç¼ºå°‘é…ç½®é€‰é¡¹ |
| **çµæ´»æ€§** | â­â­â­ | ç¡¬ç¼–ç ï¼Œä¸å¤Ÿçµæ´» |
| **é€‚ç”¨æ€§** | â­â­â­â­â­ | éå¸¸é€‚åˆä¼ä¸šéƒ¨ç½² |

### æ”¹è¿›å»ºè®®

**çŸ­æœŸ**ï¼ˆå½“å‰ä½¿ç”¨ï¼‰ï¼š
- âœ… ä¿æŒç°æœ‰å®ç°
- âœ… åœ¨æ–‡æ¡£ä¸­è¯´æ˜é™é»˜æ¨¡å¼çš„è¡Œä¸º
- âœ… æä¾›å…³é—­é™é»˜æ¨¡å¼çš„ç¼–è¯‘é€‰é¡¹

**é•¿æœŸ**ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰ï¼š
- ğŸ”„ æ·»åŠ é…ç½®æ–‡ä»¶æ”¯æŒ
- ğŸ”„ æ·»åŠ ç¯å¢ƒå˜é‡æ§åˆ¶
- ğŸ”„ æ·»åŠ å‘½ä»¤è¡Œå‚æ•° `--enable-silent-mode` / `--disable-silent-mode`
- ğŸ”„ æ·»åŠ ç³»ç»Ÿé€šçŸ¥ï¼ˆé™é»˜ä½†é€šçŸ¥ç”¨æˆ·æœ‰è¿æ¥ï¼‰

### ç»“è®º

**å½“å‰ä»£ç å·²æ­£ç¡®å®ç°é™é»˜æ¨¡å¼ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚**

ç”¨äº **Flutter Custom Build** å·¥ä½œæµæ—¶ï¼š
1. âœ… ä»£ç æ— éœ€ä¿®æ”¹ï¼ˆå·²ç»æ˜¯é™é»˜æ¨¡å¼ï¼‰
2. âœ… ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨åŒ…å«æ­¤åŠŸèƒ½
3. âœ… é€‚åˆä¼ä¸šéƒ¨ç½²å’Œæ— äººå€¼å®ˆåœºæ™¯

å¦‚æœéœ€è¦æ›´çµæ´»çš„æ§åˆ¶ï¼Œå»ºè®®å®ç°å¯é…ç½®ç‰ˆæœ¬ã€‚
